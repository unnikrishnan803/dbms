<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Blood Donation{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    {% load static %}
    <link rel="icon" href="{% static 'img/favicon.svg' %}" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/forms.css' %}">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="{% url 'home' %}">Blood Donation</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample" aria-controls="navbarsExample" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExample">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="{% url 'register' %}">Register</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'donor_list' %}">Find Donors</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'request_list' %}">Requests</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'donation_list' %}">Donations</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'blood_inventory' %}">Inventory</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'statistics' %}">Statistics</a></li>
          </ul>
          <ul class="navbar-nav ms-auto align-items-center gap-2">
            <!-- Theme Toggle Button -->
            <li class="nav-item">
              <button id="theme-toggle" class="btn btn-outline-light btn-sm" title="Toggle Theme">
                <i class="bi bi-sun-fill" id="theme-icon"></i>
              </button>
            </li>
            <!-- Theme Indicator -->
            <li class="nav-item">
              <span id="theme-indicator" class="badge bg-light text-dark" style="font-size: 0.7rem;">Light</span>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item"><a class="nav-link" href="{% url 'hospital_dashboard' %}">Hospital</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
            {% else %}
            <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags|default:'info' }} mb-2">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %}
      {% block content %}{% endblock %}
    </main>

    <footer class="py-4 border-top">
      <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between">
        <div class="text-muted small">&copy; {% now "Y" %} Blood Donation Mini Project</div>
        <div class="small">
          <i class="bi bi-droplet-fill text-danger me-2"></i>
          Donate blood, save lives
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Theme Toggle Script -->
    <script>
      // Theme management
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');
      const body = document.body;
      const themeIndicator = document.getElementById('theme-indicator');
      
      // Get saved theme or default to 'light'
      const currentTheme = localStorage.getItem('theme') || 'light';
      
      // Apply theme using CSS classes
      if (currentTheme === 'dark') {
        body.classList.add('theme-dark');
        body.classList.remove('theme-light');
      } else {
        body.classList.add('theme-light');
        body.classList.remove('theme-dark');
      }
      
      updateThemeIcon(currentTheme);
      updateThemeIndicator(currentTheme);
      
      // Debug: Check if theme was applied
      console.log('Theme applied to body:', currentTheme);
      console.log('Body classes:', body.className);
      console.log('Body computed styles:', window.getComputedStyle(body).color);
      
      // Enable smooth transitions after initial load
      setTimeout(() => {
        body.classList.add('theme-loaded');
        console.log('Theme transitions enabled');
      }, 100);
      
      // Theme toggle function
      function toggleTheme() {
        const isDark = body.classList.contains('theme-dark');
        const newTheme = isDark ? 'light' : 'dark';
        
        console.log('Switching theme from', isDark ? 'dark' : 'light', 'to', newTheme);
        
        // Toggle CSS classes
        if (newTheme === 'dark') {
          body.classList.remove('theme-light');
          body.classList.add('theme-dark');
        } else {
          body.classList.remove('theme-dark');
          body.classList.add('theme-light');
        }
        
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
        updateThemeIndicator(newTheme);
        
        // Add visual feedback
        themeToggle.style.transform = 'scale(1.2)';
        setTimeout(() => {
          themeToggle.style.transform = 'scale(1)';
        }, 200);
        
        // Force a repaint
        body.style.display = 'none';
        body.offsetHeight; // Trigger reflow
        body.style.display = '';
      }
      
      // Update icon based on theme
      function updateThemeIcon(theme) {
        if (theme === 'dark') {
          themeIcon.className = 'bi bi-moon-fill';
          themeToggle.title = 'Switch to Light Theme';
          console.log('Theme icon set to dark');
        } else {
          themeIcon.className = 'bi bi-sun-fill';
          themeToggle.title = 'Switch to Dark Theme';
          console.log('Theme icon set to light');
        }
      }
      
      // Update indicator based on theme
      function updateThemeIndicator(theme) {
        if (theme === 'dark') {
          themeIndicator.textContent = 'Dark';
          themeIndicator.classList.remove('bg-light', 'text-dark');
          themeIndicator.classList.add('bg-dark', 'text-light');
          console.log('Theme indicator set to dark');
        } else {
          themeIndicator.textContent = 'Light';
          themeIndicator.classList.remove('bg-dark', 'text-light');
          themeIndicator.classList.add('bg-light', 'text-dark');
          console.log('Theme indicator set to light');
        }
      }
      
      // Event listener
      themeToggle.addEventListener('click', toggleTheme);
      
      // Debug info
      console.log('Theme system initialized. Current theme:', currentTheme);
      console.log('Theme toggle button found:', !!themeToggle);
      console.log('Theme icon found:', !!themeIcon);
      console.log('Theme indicator found:', !!themeIndicator);
    </script>
  </body>
  </html>


